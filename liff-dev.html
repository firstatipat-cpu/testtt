<!DOCTYPE html>
<html lang="th" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Dashboard</title>
    <!-- 1. ‡πÇ‡∏´‡∏•‡∏î Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 2. ‡πÇ‡∏´‡∏•‡∏î LIFF SDK -->
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        /* ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ò‡∏µ‡∏°‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô */
        :root { color-scheme: dark; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #121212;
            color: #E0E0E0;
        }
        /* ‡∏™‡∏µ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏ô‡∏ò‡∏µ‡∏°‡∏°‡∏∑‡∏î */
        .card {
            background-color: #1E1E1E;
            border: 1px solid #333;
        }
        /* ‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏•‡∏±‡∏Å */
        .btn-primary {
            background-color: #00B900; /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß LINE */
            color: #FFFFFF;
        }
        .btn-primary:hover {
            background-color: #00A300;
        }
        /* ‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏°‡∏£‡∏≠‡∏á (‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠) */
        .btn-secondary {
            background-color: #333;
            border: 1px solid #555;
            color: #F5F5F5;
        }
        .btn-secondary:hover {
            background-color: #444;
        }
    </style>
</head>
<body class="p-4 max-w-lg mx-auto">

    <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
    <header class="flex items-center space-x-3 mb-6">
        <img id="userPicture" class="w-16 h-16 rounded-full border-2 border-gray-700" src="https://placehold.co/100x100/333/808080?text=USER" alt="User Picture">
        <div>
            <p class="text-sm text-gray-400">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏ï‡∏≠‡∏ô‡πÄ‡∏ä‡πâ‡∏≤,</p>
            <h1 id="displayName" class="text-2xl font-bold text-white">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</h1>
        </div>
    </header>

    <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Fit -->
    <div id="connect-section" class="card p-4 rounded-lg text-center" style="display: none;">
        <h2 class="font-bold mb-2">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</h2>
        <p class="text-sm text-gray-400 mb-4">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Fit ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
        <button id="btnConnectGoogle" class="btn-secondary font-bold py-2 px-6 rounded-lg w-full">
            ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Fit
        </button>
    </div>

    <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î, ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à) -->
    <div id="status-message" class="card p-4 rounded-lg text-center" style="display: none;">
        <p id="status-text" class="font-bold"></p>
    </div>

    <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û (‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô) -->
    <main id="dashboard-content" style="display: none;">
        <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå -->
        <section class="grid grid-cols-3 gap-3 mb-4 text-center">
            <div class="card p-3 rounded-lg">
                <p class="text-xs text-gray-400">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</p>
                <p class="text-xl font-bold"><span id="weight-data">--</span> <span class="text-sm font-normal">kg</span></p>
            </div>
            <div class="card p-3 rounded-lg">
                <p class="text-xs text-gray-400">‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á</p>
                <p class="text-xl font-bold"><span id="height-data">--</span> <span class="text-sm font-normal">cm</span></p>
            </div>
            <div class="card p-3 rounded-lg">
                <p class="text-xs text-gray-400">‡∏≠‡∏≤‡∏¢‡∏∏</p>
                <p class="text-xl font-bold"><span id="age-data">--</span> <span class="text-sm font-normal">‡∏õ‡∏µ</span></p>
            </div>
        </section>

        <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (‡∏Å‡πâ‡∏≤‡∏ß, ‡∏´‡∏±‡∏ß‡πÉ‡∏à) -->
        <section class="space-y-4">
            <div class="card p-4 rounded-lg flex items-center space-x-4">
                <span class="text-3xl">üëü</span>
                <div>
                    <p class="text-sm text-gray-400">‡∏Å‡πâ‡∏≤‡∏ß‡πÄ‡∏î‡∏¥‡∏ô (‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ)</p>
                    <p class="text-2xl font-bold"><span id="steps-data">--</span> <span class="text-base font-normal">‡∏Å‡πâ‡∏≤‡∏ß</span></p>
                </div>
            </div>
            <div class="card p-4 rounded-lg flex items-center space-x-4">
                <span class="text-3xl">‚ù§Ô∏è</span>
                <div>
                    <p class="text-sm text-gray-400">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡πâ‡∏ô‡∏´‡∏±‡∏ß‡πÉ‡∏à (‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢)</p>
                    <p class="text-2xl font-bold"><span id="heart-data">--</span> <span class="text-base font-normal">BPM</span></p>
                </div>
            </div>
            <div class="card p-4 rounded-lg flex items-center space-x-4">
                <span class="text-3xl">üë§</span>
                <div>
                    <p class="text-sm text-gray-400">‡πÄ‡∏û‡∏®</p>
                    <p class="text-2xl font-bold"><span id="gender-data">--</span></p>
                </div>
            </div>
        </section>
    </main>

    <!-- ‡∏õ‡∏∏‡πà‡∏° Logout (‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß) -->
    <footer class="mt-8 text-center" id="logout-footer" style="display: none;">
        <button id="btnLogout" class="text-gray-500 text-sm hover:text-red-400">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </footer>

    <script>
        // =============================================================
        // == ‚òÖ‚òÖ‚òÖ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‚òÖ‚òÖ‚òÖ (‡∏Å‡∏£‡∏≠‡∏Å 2 ‡∏ä‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ) ==
        // =============================================================
        const LIFF_ID = "2008337931-z1xeJb7D"; // üëà 1. ‡∏Å‡∏£‡∏≠‡∏Å LIFF ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        const SERVER_URL = "https://sequential-seborrheal-clelia.ngrok-free.dev"; // üëà 2. ‡∏Å‡∏£‡∏≠‡∏Å URL ‡∏Ç‡∏≠‡∏á Server (ngrok)
        // =============================================================

        // --- ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö DOM Elements ---
        const btnConnectGoogle = document.getElementById('btnConnectGoogle');
        const btnLogout = document.getElementById('btnLogout');
        
        const loadingIndicator = document.getElementById('status-message');
        const statusText = document.getElementById('status-text');
        
        const connectSection = document.getElementById('connect-section');
        const dashboardContent = document.getElementById('dashboard-content');
        const logoutFooter = document.getElementById('logout-footer');
        
        // Data Elements
        const stepsEl = document.getElementById('steps-data');
        const heartEl = document.getElementById('heart-data');
        const weightEl = document.getElementById('weight-data');
        const heightEl = document.getElementById('height-data');
        const ageEl = document.getElementById('age-data');
        const genderEl = document.getElementById('gender-data');

        /**
         * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å: ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á LIFF
         */
        async function initializeLiff() {
            try {
                await liff.init({ liffId: LIFF_ID });

                if (!liff.isLoggedIn()) {
                    // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÉ‡∏ô LINE ‡πÉ‡∏´‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô
                    liff.login();
                } else {
                    // ‡∏ñ‡πâ‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÉ‡∏ô LINE ‡πÅ‡∏•‡πâ‡∏ß
                    await setupUserInfo(); // 1. ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ LINE
                    checkConnectionStatus(); // 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ (‡∏à‡∏≤‡∏Å URL)
                    await fetchHealthData(); // 3. ‚òÖ‚òÖ‚òÖ ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‚òÖ‚òÖ‚òÖ
                }
            } catch (e) {
                console.error("LIFF Init Error:", e);
                showStatusMessage(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î: ${e.message}`, true);
            }
        }

        /**
         * 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå LINE ‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á
         */
        async function setupUserInfo() {
            const profile = await liff.getProfile();
            document.getElementById('displayName').innerText = profile.displayName;
            document.getElementById('userPicture').src = profile.pictureUrl;
            logoutFooter.style.display = 'block';
        }
        
        /**
         * 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ (‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å Redirect ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏à‡∏≤‡∏Å Google)
         */
        function checkConnectionStatus() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('connect') === 'success') {
                showStatusMessage("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Fit ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!", false);
            } else if (urlParams.get('connect') === 'error') {
                showStatusMessage(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${urlParams.get('message')}`, true);
            }
        }

        /**
         * 3. ‚òÖ‚òÖ‚òÖ (‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏≤‡∏°) ‚òÖ‚òÖ‚òÖ
         * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö "‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•" ‡∏à‡∏≤‡∏Å Backend Server ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤
         */
        async function fetchHealthData() {
            showStatusMessage("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û...", false);
            dashboardContent.style.display = 'none';
            connectSection.style.display = 'none';

            let lineUserId;
            try {
                // 3.1 ‡∏î‡∏∂‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå LINE ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏≤ lineUserId
                const profile = await liff.getProfile();
                lineUserId = profile.userId;

                // 3.2 ‡∏™‡∏£‡πâ‡∏≤‡∏á URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏¢‡∏¥‡∏á API (‡∏™‡πà‡∏á line_user_id ‡πÑ‡∏õ‡πÉ‡∏´‡πâ Server)
                const url = new URL(`${SERVER_URL}/api/get-health-data`);
                url.searchParams.append('line_user_id', lineUserId);
                
                // 3.3 ‡∏¢‡∏¥‡∏á API (Fetch) ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Server
                const response = await fetch(url);

                // 3.4 ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Response ‡∏à‡∏≤‡∏Å Server
                if (response.status === 404) {
                    // (Error 404) ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• = ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Fit
                    showStatusMessage("‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Fit ‡∏Å‡πà‡∏≠‡∏ô", true);
                    connectSection.style.display = 'block'; // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                    return;
                }
                
                if (response.status === 401) {
                    // (Error 401) Token ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏≠‡∏≤‡∏à‡∏ñ‡∏π‡∏Å‡∏ñ‡∏≠‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå)
                    showStatusMessage("‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏, ‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÉ‡∏´‡∏°", true);
                    connectSection.style.display = 'block'; // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà
                    return;
                }

                if (!response.ok) {
                    // Error ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏à‡∏≤‡∏Å Server
                    throw new Error(`Server error: ${response.statusText}`);
                }

                // 3.5 (‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!) ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô JSON
                const data = await response.json();
                
                // 3.6 ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
                updateUIWithData(data);
                
                loadingIndicator.style.display = 'none'; // ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î"
                dashboardContent.style.display = 'grid'; // ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î

            } catch (err) {
                console.error("Fetch Health Data Error:", err);
                showStatusMessage(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${err.message}`, true);
                connectSection.style.display = 'block';
            }
        }

        /**
         * 4. ‚òÖ‚òÖ‚òÖ (‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà "‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô" ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•) ‚òÖ‚òÖ‚òÖ
         * ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏ô HTML ‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å JSON
         */
        function updateUIWithData(data) {
            // ‡πÉ‡∏ä‡πâ data.steps (‡∏à‡∏≤‡∏Å JSON) ‡πÑ‡∏õ‡πÉ‡∏™‡πà‡πÉ‡∏ô Element ‡∏ó‡∏µ‡πà‡∏°‡∏µ id="steps-data"
            // (?? '--' ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á: ‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô null ‡∏´‡∏£‡∏∑‡∏≠ undefined ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á '--' ‡πÅ‡∏ó‡∏ô)
            stepsEl.innerText = data.steps ?? '--';
            heartEl.innerText = data.heartRate ?? '--';
            weightEl.innerText = data.weight ?? '--';
            heightEl.innerText = data.height ?? '--';
            ageEl.innerText = data.age ?? '--';
            genderEl.innerText = data.gender ?? '--';
        }

        /**
         * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢: ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
         */
        function showStatusMessage(message, isError = false) {
            statusText.innerText = message;
            statusText.className = isError ? 'font-bold text-red-400' : 'font-bold text-green-400';
            loadingIndicator.style.display = 'block';
        }

        // --- Event Listeners ---
        
        // (‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google)
        btnConnectGoogle.addEventListener('click', async () => {
            try {
                // 1. ‡πÄ‡∏≠‡∏≤ lineUserId
                const profile = await liff.getProfile();
                const lineUserId = profile.userId;
                
                // 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏° Auth (‡∏ó‡∏µ‡πà Server ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤)
                const authUrl = `${SERVER_URL}/auth/google/start?line_user_id=${lineUserId}`;
                
                // 3. (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç!) ‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡πâ‡∏ß‡∏¢ liff.openWindow ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ 403:disallowed_useragent
                alert('‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Fit');
                liff.openWindow({
                    url: authUrl,
                    external: true // ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å (Chrome/Safari)
                });

            } catch (err) {
                console.error("Connect Error:", err);
                showStatusMessage(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${err.message}`, true);
            }
        });

        // (‡∏õ‡∏∏‡πà‡∏° Logout)
        btnLogout.addEventListener('click', () => {
            if (liff.isLoggedIn()) {
                liff.logout();
                window.location.reload();
            }
        });

        // --- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ---
        document.addEventListener('DOMContentLoaded', initializeLiff);

    </script>
</body>
</html>

